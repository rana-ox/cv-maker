<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Premium CV Builder | Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg:#0e1117; --paper:#161b22; --ink:#e6edf3; --muted:#8b949e; --line:#30363d;
            --brand:#58a6ff; --radius:16px; --shadow:0 12px 30px rgba(0,0,0,0.35);
        }
        [data-theme="light"] {
            --bg:#f6f8fa; --paper:#ffffff; --ink:#1f2328; --muted:#6b7280; --line:#d0d7de;
            --brand:#0969da; --shadow:0 12px 30px rgba(31,36,48,0.12);
        }
        * { box-sizing: border-box; }
        body { margin: 0; background: var(--bg); color: var(--ink); font-family: Inter, system-ui, Arial; transition: background .3s, color .3s; }
        
        header { position: sticky; top: 0; background: var(--paper); border-bottom: 1px solid var(--line); z-index: 100; }
        .wrap { max-width: 1200px; margin: 0 auto; padding: 15px 24px; }
        .bar { display: flex; align-items: center; justify-content: space-between; }
        
        .btn { padding: 10px 20px; border: 1px solid var(--line); border-radius: 10px; background: var(--bg); color: var(--ink); cursor: pointer; font-weight: 600; }
        .btn:hover { border-color: var(--brand); color: var(--brand); }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; margin-top: 30px; opacity: 1; }
        
        .card { background: var(--paper); border: 1px solid var(--line); border-radius: var(--radius); overflow: hidden; cursor: pointer; transition: 0.3s; }
        .card:hover { transform: translateY(-5px); border-color: var(--brand); }
        .thumb { height: 150px; background: linear-gradient(45deg, var(--brand), transparent); opacity: 0.3; display: flex; align-items: center; justify-content: center; font-size: 40px; }
        .card-body { padding: 20px; }

        .modal { position: fixed; inset: 0; display: none; place-items: center; background: rgba(0,0,0,0.8); z-index: 1000; }
        .modal.show { display: grid; }
        .sheet { width: 90%; height: 90%; background: white; border-radius: 15px; overflow: hidden; display: flex; flex-direction: column; }
        iframe { flex: 1; border: none; width: 100%; }

        #splash { position: fixed; inset: 0; background: #0e1117; z-index: 9999; display: flex; align-items: center; justify-content: center; flex-direction: column; }
        .orb { width: 50px; height: 50px; border: 3px solid #30363d; border-top-color: #58a6ff; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div id="splash">
    <div class="orb"></div>
    <p style="color: #58a6ff; margin-top: 15px; font-weight: bold;">LOADING STUDIO...</p>
</div>

<header>
    <div class="wrap bar">
        <h1 style="margin:0; font-family:'Playfair Display', serif;">CV Studio</h1>
        <div style="display:flex; gap:10px">
            <button class="btn" id="themeToggle">ðŸŒ“ Theme</button>
            <button class="btn" id="reloadBtn">ðŸ”„ Reload</button>
        </div>
    </div>
</header>

<main class="wrap">
    <h2 style="margin-top:40px">Available Templates</h2>
    <div id="grid" class="grid"></div>
</main>

<div id="modal" class="modal">
    <div class="sheet">
        <div style="padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; background: #eee; color: #333;">
            <b id="modalTitle">Preview</b>
            <button onclick="closeModal()" style="cursor:pointer; padding: 5px 10px;">Close âœ•</button>
        </div>
        <iframe id="templateFrame"></iframe>
    </div>
</div>

<script>
    // --- 1. SETTINGS & DATA ---
    const FALLBACK_TEMPLATES = [
        { name: "Executive Dark", path: "CVs/template1.html", desc: "Professional sidebar layout." },
        { name: "Minimalist Light", path: "CVs/template2.html", desc: "Clean and modern design." }
    ];

    // --- 2. THEME LOGIC (Fixed) ---
    const themeBtn = document.getElementById('themeToggle');
    themeBtn.addEventListener('click', () => {
        const root = document.documentElement;
        const isLight = root.getAttribute('data-theme') === 'light';
        root.setAttribute('data-theme', isLight ? 'dark' : 'light');
    });

    // --- 3. RELOAD LOGIC (Fixed) ---
    document.getElementById('reloadBtn').addEventListener('click', () => {
        location.reload();
    });

    // --- 4. TEMPLATE LOADING ---
    async function loadTemplates() {
        const grid = document.getElementById('grid');
        grid.innerHTML = '';

        let data = [];
        try {
            const res = await fetch('./CVs/templates.json');
            if (res.ok) {
                data = await res.json();
            } else {
                console.warn("Using fallback templates...");
                data = FALLBACK_TEMPLATES;
            }
        } catch (e) {
            console.error("Fetch failed (likely CORS). Using backup.");
            data = FALLBACK_TEMPLATES;
        }

        data.forEach(item => {
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <div class="thumb">ðŸ“„</div>
                <div class="card-body">
                    <h3 style="margin:0">${item.name}</h3>
                    <p style="color:var(--muted); font-size:14px">${item.desc || 'Standard Layout'}</p>
                </div>
            `;
            card.onclick = () => openModal(item.path, item.name);
            grid.appendChild(card);
        });
    }

    // --- 5. MODAL LOGIC ---
    function openModal(path, name) {
        document.getElementById('modal').classList.add('show');
        document.getElementById('templateFrame').src = path;
        document.getElementById('modalTitle').innerText = name;
    }

    function closeModal() {
        document.getElementById('modal').classList.remove('show');
        document.getElementById('templateFrame').src = '';
    }

    // --- 6. INITIALIZE ---
    window.onload = () => {
        loadTemplates();
        setTimeout(() => {
            document.getElementById('splash').style.display = 'none';
        }, 800);
    };
</script>

</body>
</html>
